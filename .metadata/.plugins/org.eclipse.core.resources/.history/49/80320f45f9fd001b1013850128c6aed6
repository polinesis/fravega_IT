package com.example.microservicios.app.sucursales;


import static org.hamcrest.CoreMatchers.notNullValue;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertNull;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.util.Optional;

import javax.validation.ConstraintViolationException;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.ResponseEntity;

import com.example.commons.sucursales.models.entity.Sucursal;
import com.example.microservicios.app.sucursales.controllers.SucursalController;



@SpringBootTest
class MicroservicioSucursalesApplicationTests {

	
	@Autowired
	SucursalController sucursalController;
	
	/*
	 * probamos caso exitoso de creacion de sucursal
	 * */
	@Test
	void testCrear() {
		
		Sucursal sucursal = new Sucursal();
		
		int numeroAleatorio = (int) (Math.random()*25+1);
		sucursal.setDireccion("TEST - angel gallardo numero:"+numeroAleatorio);
		sucursal.setHorarioAtencion("TEST - Lunes a viernes de 9 a 3");
		sucursal.setLatitud(-34.57060);
		sucursal.setLongitud(-58.72734);
		
		/*
		Sucursal  sucursalSave = sucursalController.getService().save(sucursal);
		Optional<Sucursal> o = sucursalController.getService().findById(sucursalSave.getId());
		
		Sucursal sucursalBd =  o.get();
		
		assertEquals("TEST - angel gallardo numero:"+numeroAleatorio+"", sucursalBd.getDireccion());
		*/
	}
	
	/*
	 * probamos que no se debe crear sucursales al agregar direccion en null
	 * */
	@Test
	void testErrorCrear() {
		
		Sucursal sucursal = new Sucursal();
		
		sucursal.setDireccion(null);
		sucursal.setHorarioAtencion("TEST - Lunes a viernes de 9 a 3");
		sucursal.setLatitud(-34.57060);
		sucursal.setLongitud(-58.72734);
		
		Sucursal  sucursalSave = null;
		
		try {
		
			sucursalSave = sucursalController.getService().save(sucursal);
		
		}catch (ConstraintViolationException e) {
			e.printStackTrace();
		}
		
		assertNull(sucursalSave);
		
	}
	
	/*
	 * probamos la devolucion de todas las sucursales
	 * */
	@Test
	void getSucursales() {
		
		assertNotNull(sucursalController.getService().findAll());
		
	}
	
	/*
	 * aca vamos a probar calculo de distancia 
	 * 
	 * set de datos prueba
	 * 1 - Carrefour, los polvorines  latitud : -34.53051 , longitud -58.70278
	 * 2 - Abasto bs as,  latitud : -34.60085 , longitud -58.40347
	 * 3 - Estadio Monumental River PLate , latitud : -34.54399 , longitud : -58.45002
	 * 
	 * input 
	 *  
	 *  Jardín Japonés
	 *  latitud : -34.575533  , longitud : -58.41718
	 * 
	 * output : se debe asignar la sucursal abasto como la mas cercana
	 * */
	@Test
	void obtenerSucursalMasCernaca() {
		
		
		puntoRetiro
		
		sucursalController.obtenerSucursalMasCernaca(puntoRetiro)
		
		assertNotNull(sucursalController.getService().findAll());
		
	}
	
	
	
	

}
